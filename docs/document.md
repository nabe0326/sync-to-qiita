# microCMS to Qiita 自動同期システム 要件定義書

## 1. プロジェクト概要

### 1.1 背景
- 現在、ブログ記事をmicroCMSで管理し、独自サイトで公開している
- SEO強化のため、技術記事をQiitaにも掲載したい
- 手動での二重投稿は手間がかかるため、自動化したい

### 1.2 目的
- microCMSで管理している記事を自動的にQiitaに同期する
- 記事の新規投稿・更新を自動検知して反映する
- 運用の手間を最小限に抑える

### 1.3 期待される効果
- 記事の露出増加によるアクセス数向上
- Qiitaコミュニティからの技術的フィードバック獲得
- 記事管理の一元化による運用効率化

## 2. システム構成

### 2.1 利用サービス
| サービス | 用途 | 料金 |
|---------|------|------|
| microCMS | 記事管理CMS | 既存利用 |
| Qiita | 技術記事投稿先 | 無料 |
| GitHub Actions | 自動化処理実行 | 無料（月2000分） |
| GitHub | コード・履歴管理 | 無料 |

### 2.2 システムアーキテクチャ
```
[microCMS] --API--> [GitHub Actions] --API--> [Qiita]
                            |
                            v
                    [同期履歴 (JSON)]
```

## 3. 機能要件

### 3.1 記事同期機能

#### 3.1.1 新規投稿
- microCMSの新規記事を検知
- Qiitaに自動投稿
- 投稿履歴を記録

#### 3.1.2 記事更新
- microCMSの記事更新を検知（updatedAtで判定）
- 対応するQiita記事を更新
- 更新履歴を記録

#### 3.1.3 同期対象の条件
- microCMSで公開状態の記事のみ
- 下書き（draft）は同期しない

### 3.2 データ変換機能

#### 3.2.1 コンテンツ変換
| microCMS | Qiita | 変換内容 |
|----------|--------|----------|
| title | title | そのまま使用 |
| content (HTML) | body (Markdown) | HTML→Markdown変換 |
| excerpt | body冒頭 | 概要として冒頭に挿入（任意） |
| tags | tags | タグとして設定 |
| category | tags | タグに追加 |

#### 3.2.2 HTML→Markdown変換仕様
- 見出し: `<h1>`〜`<h6>` → `#`〜`######`
- 段落: `<p>` → 改行で区切る
- 強調: `<strong>`, `<b>` → `**text**`
- コード: `<code>` → `` `code` ``
- コードブロック: `<pre><code>` → ` ```言語名 `
- リンク: `<a>` → `[text](url)`
- 画像: `<img>` → `![alt](url)`
- リスト: `<ul><li>` → `- item`

#### 3.2.3 メタデータ設定
- Qiitaのprivate: false（公開設定）
- 記事末尾に元記事へのリンクを自動追加
- タグは最大5個まで（Qiita制限）

### 3.3 スケジュール実行
- 毎日日本時間9:00に自動実行
- 手動実行もGitHub Actionsから可能

### 3.4 履歴管理
- `sync-history.json`で同期状態を管理
- 記録する情報：
  - microCMS記事ID
  - Qiita記事ID
  - 最終同期日時
  - 記事タイトル

## 4. 非機能要件

### 4.1 性能要件
- API制限を考慮し、各投稿後2秒の待機時間を設定
- 1回の実行で最大50記事まで処理

### 4.2 セキュリティ要件
- APIキーはGitHub Secretsで管理
- 公開リポジトリでも安全に運用可能
- 同期履歴に個人情報は含めない

### 4.3 可用性要件
- エラーが発生しても他の記事の処理は継続
- 詳細なエラーログを出力
- GitHub Actionsの実行履歴で状況確認可能

### 4.4 運用要件
- 初期設定は10分程度で完了
- 日常的なメンテナンスは不要
- エラー時のみ対応が必要

## 5. 制約事項

### 5.1 技術的制約
- Qiita API: 1時間あたり1000リクエストまで
- Qiitaのタグ: 1記事5個まで
- GitHub Actions: 月2000分の無料枠

### 5.2 仕様上の制約
- Qiitaは技術記事のみ（規約遵守）
- 画像はmicroCMSのURLをそのまま使用
- Qiitaの記事削除は手動対応

## 6. 開発スコープ

### 6.1 Phase 1（初期リリース）
- [x] 基本的な同期機能
- [x] HTML→Markdown変換
- [x] GitHub Actions設定
- [x] 履歴管理機能
- [x] エラーハンドリング

### 6.2 Phase 2（将来拡張）
- [ ] 特定カテゴリ/タグのフィルタリング
- [ ] 同期レポートのIssue作成
- [ ] Slack通知連携
- [ ] 画像の最適化・再アップロード

## 7. ディレクトリ構成
```
microcms-qiita-sync/
├── .github/
│   └── workflows/
│       └── sync-to-qiita.yml    # GitHub Actions設定
├── scripts/
│   ├── sync-microcms-to-qiita.js # メイン同期スクリプト
│   └── utils/
│       └── html-to-markdown.js   # 変換ユーティリティ
├── .gitignore                    # Git除外設定
├── .env.example                  # 環境変数テンプレート
├── package.json                  # 依存関係定義
├── README.md                     # セットアップ手順
└── sync-history.json            # 同期履歴（自動生成）
```

## 8. 環境変数
| 変数名 | 説明 | 取得方法 |
|--------|------|----------|
| MICROCMS_DOMAIN | microCMSのドメイン | 管理画面から確認 |
| MICROCMS_API_KEY | microCMS APIキー | 設定→APIキー |
| QIITA_ACCESS_TOKEN | Qiitaアクセストークン | 設定→アプリケーション |

## 9. 成功基準
- microCMSで記事を公開すると、24時間以内にQiitaに反映される
- 記事の更新が正しく検知・反映される
- エラーが発生してもシステムが停止しない
- 月間のAPI制限内で運用可能

## 10. リスクと対策
| リスク | 影響度 | 対策 |
|--------|--------|------|
| API制限超過 | 中 | 待機時間設定、処理数制限 |
| 記事フォーマット崩れ | 小 | 変換処理の改善、ログ確認 |
| 重複投稿 | 中 | 履歴管理による制御 |
| APIキー漏洩 | 大 | GitHub Secrets使用 |

---

この要件定義書に基づいて、microCMS to Qiita自動同期システムを実装します。